import{D as F}from"./index.37d00dc6.js";import{_ as D}from"./index.2dff9388.js";/* empty css                  *//* empty css                 *//* empty css                     */import{r as C,d as u,a as S,b as $,c as I}from"./date.9a6a4d57.js";import{o as s,t as m,a as h,F as k,y,A as w,x as z,W as P,V as E,b as g,X as Y,a2 as B,a3 as R,a4 as q,K as A,a5 as L,c as j,w as x,z as M}from"./elementPlus.e1b2604b.js";const N={props:{date:Date,schedule:Array},inject:["Calendar"],data(){return{weekDays:["\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D","\u5468\u65E5"]}},methods:{getFormateDate(e,t){let o=this.curMonthDatePrefix;return t==="prev"?o=this.prevMonthDatePrefix:t==="next"&&(o=this.nextMonthDatePrefix),e=`0${e}`.slice(-2),`${o}-${e}`},getFormateDateTimestamp(e){const t=e.split("-");return new Date(t[0],t[1]-1,t[2]).getTime()},getCellClass({type:e,formatedDate:t}){const o=[e];return e==="current"&&t===this.formatedToday&&o.push("is-today"),o},transformMonthDays(e,t){return e.map(o=>{const a=this.getFormateDate(o,t),l=this.getFormateDateTimestamp(a);return{formatedDate:a,timestamp:l,text:o,type:t}})},toNestedArr(e){return C(e.length/7).map((t,o)=>{const a=o*7;return e.slice(a,a+7)})},getInsertRow(e,t,o){if(e.length===0)return 0;const a=t+o>7?7:t+o+1;let l=-1;for(let r=0,n=e.length;r<n;r++)if(e[r].slice(t,a).every(d=>d.isPlaceholder)){l=r;break}return l},onPickDay(e){this.Calendar.pickDay(e)},onPickSchedule(e){this.Calendar.pickSchedule(e)}},computed:{prevMonthDatePrefix(){const e=new Date(this.date.getTime());return e.setDate(0),u(e,"yyyy-mm")},curMonthDatePrefix(){return u(this.date,"yyyy-mm")},nextMonthDatePrefix(){const e=new Date(this.date.getFullYear(),this.date.getMonth()+1,1);return u(e,"yyyy-mm")},formatedToday(){return this.Calendar.formatedToday},rows(){const{date:e}=this;let t=[],o=S(e);o=o===0?7:o;const a=this.transformMonthDays($(e,o-1),"prev"),l=this.transformMonthDays(I(e),"current");t=[...a,...l];const r=this.transformMonthDays(C(42-t.length),"next");return t=t.concat(r),this.toNestedArr(t)},scheduleList(){const e=[[],[],[],[],[],[]],{rows:t,schedule:o}=this,a=["#99CCCC","#99CCFF","#FF99CC","#FF9999","#99CC66","#FF9900","#666699","#FF6666"];return o.map((r,n)=>{const d=this.getFormateDateTimestamp(r.startDate),p=this.getFormateDateTimestamp(r.endDate),i=(p-d)/(24*60*60*1e3);return{...r,startTimestamp:d,endTimestamp:p,bgColor:a[n%8],durationDays:i}}).forEach(r=>{t.forEach((n,d)=>{const p=[{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0}];let i=0;n.forEach((c,f)=>{if(c.timestamp>=r.startTimestamp&&c.timestamp<=r.endTimestamp){const _=c.timestamp===r.startTimestamp,v=e[d];if(_)i=this.getInsertRow(v,f,r.durationDays);else if(f===0){const b=(r.endTimestamp-c.timestamp)/864e5;i=this.getInsertRow(v,f,b)}v.length==0?v.push(p):i===-1&&(v.push(p),i=v.length-1),v[i][f]={isStart:_,showTitle:_||f===0,title:r.title||"",id:r.id,bgColor:r.bgColor}}})})}),e}}},U={class:"calendar-table",cellspacing:0,cellpadding:0},O={class:"calendar-table-head"},X=["onClick"],Z={key:0,class:"schedule-placeholder"},K=["onClick"];function W(e,t,o,a,l,r){return s(),m("table",U,[h("thead",O,[(s(!0),m(k,null,y(l.weekDays,n=>(s(),m("th",{key:n},w(n),1))),128))]),h("tbody",null,[(s(!0),m(k,null,y(r.rows,(n,d)=>(s(),m("tr",{key:d,class:z({"calendar-table__row":!0})},[(s(!0),m(k,null,y(n,(p,i)=>(s(),m("td",{key:i,class:z(r.getCellClass(p))},[h("div",{class:"calendar-day",onClick:P(c=>r.onPickDay(p),["stop"])},[h("span",null,w(p.text),1),(s(!0),m(k,null,y(r.scheduleList[d],(c,f)=>(s(),m("div",{key:f},[c[i].isPlaceholder?(s(),m("div",Z)):(s(),m("div",{key:1,class:z(["schedule-item",{"is-start":c[i].isStart}]),style:E({"background-color":c[i].bgColor}),onClick:P(_=>r.onPickSchedule(c[i]),["stop"])},w(c[i].showTitle?c[i].title:""),15,K))]))),128))],8,X)],2))),128))]))),128))])])}var T=D(N,[["render",W],["__scopeId","data-v-316c852a"]]);const G={name:"Calendar",components:{DateTable:T},props:{schedule:Array},provide(){return{Calendar:this}},data(){return{selectedDay:"",now:new Date}},methods:{selectDate(e){let t="";e==="prev-month"?t=`${this.prevMonthDatePrefix}-01`:e==="next-month"?t=`${this.nextMonthDatePrefix}-01`:t=this.formatedToday,this.selectedDay=t},pickDay(e){this.$emit("pick-day",e)},pickSchedule(e){const{id:t,title:o}=e;this.$emit("pick-schedule",{id:t,title:o})}},computed:{prevMonthDatePrefix(){const e=new Date(this.date.getTime());return e.setDate(0),u(e,"yyyy-mm")},nextMonthDatePrefix(){const e=new Date(this.date.getFullYear(),this.date.getMonth()+1,1);return u(e,"yyyy-mm")},currentDate(){const e=this.date.getFullYear(),t=this.date.getMonth()+1;return`${e} \u5E74 ${t} \u6708`},formatedToday(){return u(this.now,"yyyy-mm-dd")},date(){if(this.selectedDay){const e=this.selectedDay.split("-");return new Date(e[0],e[1]-1,e[2])}return this.now}}},H={class:"calendar"},J={class:"calendar__header"},Q={class:"calendar__title"},ee={class:"calendar__button-group"},te={class:"calendar__body"};function re(e,t,o,a,l,r){const n=T;return s(),m("div",H,[h("div",J,[h("div",Q,w(r.currentDate),1),h("div",ee,[h("button",{class:"btn",onClick:t[0]||(t[0]=d=>r.selectDate("prev-month"))},"\u4E0A\u4E2A\u6708"),h("button",{class:"btn",onClick:t[1]||(t[1]=d=>r.selectDate("today"))},"\u4ECA\u5929"),h("button",{class:"btn",onClick:t[2]||(t[2]=d=>r.selectDate("next-month"))},"\u4E0B\u4E2A\u6708")])]),h("div",te,[g(n,{date:r.date,schedule:o.schedule},null,8,["date","schedule"])])])}var V=D(G,[["render",re],["__scopeId","data-v-11d123d3"]]);const oe={components:{Demo:F,Calendar:V},name:"PromotionCalendar",data(){return{demoInfo:{title:"\u4FC3\u9500\u65E5\u5386",url:""},schedule:[],dialogFormVisible:!1,form:{title:"",startDate:"",endDate:""},formRules:{title:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}],startDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u65E5\u671F",trigger:"change"}],endDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u65E5\u671F",trigger:"change"}]}}},created(){this.getScheduleList()},methods:{async getScheduleList(){let e=await this.req({url:"/demo/calendar"});e.result&&e.result.list&&(this.schedule=e.result.list)},onPickDay(e){const{formatedDate:t}=e;this.dialogFormVisible=!0,this.form.startDate=t},onPickSchedule(e){const{id:t}=e,o=this.schedule.find(a=>a.id===t);o&&(this.form={...o},this.dialogFormVisible=!0)},onDialogBtnClick(e){e==="cancel"?(this.dialogFormVisible=!1,this.$refs.form.resetFields(),this.form={title:"",startDate:"",endDate:""}):e==="confirm"&&this.$refs.form.validate(async t=>{if(t){const{schedule:o,form:a}=this;if(a.id){const l=this.schedule.findIndex(r=>r.id===a.id);this.$set(this.schedule,l,a)}else{const l=o[o.length-1].id+1,r={...a,id:l};this.schedule.push(r)}this.dialogFormVisible=!1}})}}},le=M("\u53D6 \u6D88"),ae=M("\u786E \u5B9A");function ie(e,t,o,a,l,r){const n=V,d=Y,p=B,i=R,c=q,f=A,_=L,v=F;return s(),j(v,{data:l.demoInfo},{default:x(()=>[g(n,{schedule:l.schedule,onPickDay:r.onPickDay,onPickSchedule:r.onPickSchedule},null,8,["schedule","onPickDay","onPickSchedule"]),g(_,{title:"\u65B0\u589E\u4FC3\u9500\u6D3B\u52A8",modelValue:l.dialogFormVisible,"onUpdate:modelValue":t[5]||(t[5]=b=>l.dialogFormVisible=b),width:"500px"},{footer:x(()=>[g(f,{onClick:t[3]||(t[3]=b=>r.onDialogBtnClick("cancel"))},{default:x(()=>[le]),_:1}),g(f,{type:"primary",onClick:t[4]||(t[4]=b=>r.onDialogBtnClick("confirm"))},{default:x(()=>[ae]),_:1})]),default:x(()=>[g(c,{model:l.form,rules:l.formRules,"label-width":"100px",ref:"form"},{default:x(()=>[g(p,{label:"\u6D3B\u52A8\u540D\u79F0:",prop:"title"},{default:x(()=>[g(d,{modelValue:l.form.title,"onUpdate:modelValue":t[0]||(t[0]=b=>l.form.title=b),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),g(p,{label:"\u5F00\u59CB\u65E5\u671F\uFF1A",prop:"startDate"},{default:x(()=>[g(i,{modelValue:l.form.startDate,"onUpdate:modelValue":t[1]||(t[1]=b=>l.form.startDate=b),type:"date",style:{width:"300px"},"value-format":"yyyy-MM-dd"},null,8,["modelValue"])]),_:1}),g(p,{label:"\u7ED3\u675F\u65E5\u671F\uFF1A",prop:"endDate"},{default:x(()=>[g(i,{modelValue:l.form.endDate,"onUpdate:modelValue":t[2]||(t[2]=b=>l.form.endDate=b),type:"date",style:{width:"300px"},"value-format":"yyyy-MM-dd"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1},8,["data"])}var be=D(oe,[["render",ie],["__scopeId","data-v-50ad4e0a"]]);export{be as default};
