import{D as T}from"./index.fe1635c8.js";import{_ as x}from"./index.fb6ea2b7.js";/* empty css                  *//* empty css                   *//* empty css                  *//* empty css                     *//* empty css                       *//* empty css                 *//* empty css                     */import{r as P,d as b,a as $,b as E,c as I}from"./date.e37664b7.js";import{o as m,m as u,z as _,G as C,H as v,J as k,y as w,a5 as F,K as B,a as h,a6 as R,a9 as L,aa as A,ab as N,_ as q,ac as U,c as z,w as D,O as M}from"./elementPlus.2d35d10b.js";const Y={props:{date:Date,schedule:Array},inject:["Calendar"],data(){return{weekDays:["\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D","\u5468\u65E5"]}},methods:{getFormateDate(e,t){let a=this.curMonthDatePrefix;return t==="prev"?a=this.prevMonthDatePrefix:t==="next"&&(a=this.nextMonthDatePrefix),e=`0${e}`.slice(-2),`${a}-${e}`},getFormateDateTimestamp(e){const t=e.split("-");return new Date(t[0],t[1]-1,t[2]).getTime()},getCellClass({type:e,formatedDate:t}){const a=[e];return e==="current"&&t===this.formatedToday&&a.push("is-today"),a},transformMonthDays(e,t){return e.map(a=>{const o=this.getFormateDate(a,t),r=this.getFormateDateTimestamp(o);return{formatedDate:o,timestamp:r,text:a,type:t}})},toNestedArr(e){return P(e.length/7).map((t,a)=>{const o=a*7;return e.slice(o,o+7)})},getInsertRow(e,t,a){if(e.length===0)return 0;const o=t+a>7?7:t+a+1;let r=-1;for(let s=0,l=e.length;s<l;s++)if(e[s].slice(t,o).every(i=>i.isPlaceholder)){r=s;break}return r},onPickDay(e){this.Calendar.pickDay(e)},onPickSchedule(e){this.Calendar.pickSchedule(e)}},computed:{prevMonthDatePrefix(){const e=new Date(this.date.getTime());return e.setDate(0),b(e,"yyyy-mm")},curMonthDatePrefix(){return b(this.date,"yyyy-mm")},nextMonthDatePrefix(){const e=new Date(this.date.getFullYear(),this.date.getMonth()+1,1);return b(e,"yyyy-mm")},formatedToday(){return this.Calendar.formatedToday},rows(){const{date:e}=this;let t=[],a=$(e);a=a===0?7:a;const o=this.transformMonthDays(E(e,a-1),"prev"),r=this.transformMonthDays(I(e),"current");t=[...o,...r];const s=this.transformMonthDays(P(42-t.length),"next");return t=t.concat(s),this.toNestedArr(t)},scheduleList(){const e=[[],[],[],[],[],[]],{rows:t,schedule:a}=this,o=["#99CCCC","#99CCFF","#FF99CC","#FF9999","#99CC66","#FF9900","#666699","#FF6666"];return a.map((s,l)=>{const i=this.getFormateDateTimestamp(s.startDate),c=this.getFormateDateTimestamp(s.endDate),n=(c-i)/(24*60*60*1e3);return{...s,startTimestamp:i,endTimestamp:c,bgColor:o[l%8],durationDays:n}}).forEach(s=>{t.forEach((l,i)=>{const c=[{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0}];let n=0;l.forEach((d,f)=>{if(d.timestamp>=s.startTimestamp&&d.timestamp<=s.endTimestamp){const g=d.timestamp===s.startTimestamp,y=e[i];if(g)n=this.getInsertRow(y,f,s.durationDays);else if(f===0){const p=(s.endTimestamp-d.timestamp)/864e5;n=this.getInsertRow(y,f,p)}y.length==0?y.push(c):n===-1&&(y.push(c),n=y.length-1),y[n][f]={isStart:g,showTitle:g||f===0,title:s.title||"",id:s.id,bgColor:s.bgColor}}})})}),e}}},O={class:"calendar-table",cellspacing:0,cellpadding:0},j={class:"calendar-table-head"},G=["onClick"],H={key:0,class:"schedule-placeholder"},J=["onClick"];function K(e,t,a,o,r,s){return m(),u("table",O,[_("thead",j,[(m(!0),u(C,null,v(r.weekDays,l=>(m(),u("th",{key:l},k(l),1))),128))]),_("tbody",null,[(m(!0),u(C,null,v(s.rows,(l,i)=>(m(),u("tr",{key:i,class:w({"calendar-table__row":!0})},[(m(!0),u(C,null,v(l,(c,n)=>(m(),u("td",{key:n,class:w(s.getCellClass(c))},[_("div",{class:"calendar-day",onClick:F(d=>s.onPickDay(c),["stop"])},[_("span",null,k(c.text),1),(m(!0),u(C,null,v(s.scheduleList[i],(d,f)=>(m(),u("div",{key:f},[d[n].isPlaceholder?(m(),u("div",H)):(m(),u("div",{key:1,class:w(["schedule-item",{"is-start":d[n].isStart}]),style:B({"background-color":d[n].bgColor}),onClick:F(g=>s.onPickSchedule(d[n]),["stop"])},k(d[n].showTitle?d[n].title:""),15,J))]))),128))],8,G)],2))),128))]))),128))])])}const V=x(Y,[["render",K],["__scopeId","data-v-0ab66e7e"]]);const Q={name:"Calendar",components:{DateTable:V},props:{schedule:Array},provide(){return{Calendar:this}},data(){return{selectedDay:"",now:new Date}},methods:{selectDate(e){let t="";e==="prev-month"?t=`${this.prevMonthDatePrefix}-01`:e==="next-month"?t=`${this.nextMonthDatePrefix}-01`:t=this.formatedToday,this.selectedDay=t},pickDay(e){this.$emit("pick-day",e)},pickSchedule(e){const{id:t,title:a}=e;this.$emit("pick-schedule",{id:t,title:a})}},computed:{prevMonthDatePrefix(){const e=new Date(this.date.getTime());return e.setDate(0),b(e,"yyyy-mm")},nextMonthDatePrefix(){const e=new Date(this.date.getFullYear(),this.date.getMonth()+1,1);return b(e,"yyyy-mm")},currentDate(){const e=this.date.getFullYear(),t=this.date.getMonth()+1;return`${e} \u5E74 ${t} \u6708`},formatedToday(){return b(this.now,"yyyy-mm-dd")},date(){if(this.selectedDay){const e=this.selectedDay.split("-");return new Date(e[0],e[1]-1,e[2])}return this.now}}},W={class:"calendar"},X={class:"calendar__header"},Z={class:"calendar__title"},ee={class:"calendar__button-group"},te={class:"calendar__body"};function se(e,t,a,o,r,s){const l=V;return m(),u("div",W,[_("div",X,[_("div",Z,k(s.currentDate),1),_("div",ee,[_("button",{class:"btn",onClick:t[0]||(t[0]=i=>s.selectDate("prev-month"))},"\u4E0A\u4E2A\u6708"),_("button",{class:"btn",onClick:t[1]||(t[1]=i=>s.selectDate("today"))},"\u4ECA\u5929"),_("button",{class:"btn",onClick:t[2]||(t[2]=i=>s.selectDate("next-month"))},"\u4E0B\u4E2A\u6708")])]),_("div",te,[h(l,{date:s.date,schedule:a.schedule},null,8,["date","schedule"])])])}const S=x(Q,[["render",se],["__scopeId","data-v-4ae8b1e0"]]);const ae={components:{Demo:T,Calendar:S},name:"PromotionCalendar",data(){return{demoInfo:{title:"\u4FC3\u9500\u65E5\u5386",url:""},schedule:[],dialogFormVisible:!1,form:{title:"",startDate:"",endDate:""},formRules:{title:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}],startDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u65E5\u671F",trigger:"change"}],endDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u65E5\u671F",trigger:"change"}]}}},created(){this.getScheduleList()},methods:{async getScheduleList(){let e=await this.req({url:"/demo/calendar"});e.result&&e.result.list&&(this.schedule=e.result.list)},onPickDay(e){const{formatedDate:t}=e;this.dialogFormVisible=!0,this.form.startDate=t},onPickSchedule(e){const{id:t}=e,a=this.schedule.find(o=>o.id===t);a&&(this.form={...a},this.dialogFormVisible=!0)},onDialogBtnClick(e){e==="cancel"?(this.dialogFormVisible=!1,this.$refs.form.resetFields(),this.form={title:"",startDate:"",endDate:""}):e==="confirm"&&this.$refs.form.validate(async t=>{if(t){const{schedule:a,form:o}=this;if(o.id){const r=this.schedule.findIndex(s=>s.id===o.id);this.$set(this.schedule,r,o)}else{const r=a[a.length-1].id+1,s={...o,id:r};this.schedule.push(s)}this.dialogFormVisible=!1}})}}};function re(e,t,a,o,r,s){const l=S,i=R,c=L,n=A,d=N,f=q,g=U,y=T;return m(),z(y,{data:r.demoInfo},{default:D(()=>[h(l,{schedule:r.schedule,onPickDay:s.onPickDay,onPickSchedule:s.onPickSchedule},null,8,["schedule","onPickDay","onPickSchedule"]),h(g,{title:"\u65B0\u589E\u4FC3\u9500\u6D3B\u52A8",modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[5]||(t[5]=p=>r.dialogFormVisible=p),width:"500px"},{footer:D(()=>[h(f,{onClick:t[3]||(t[3]=p=>s.onDialogBtnClick("cancel"))},{default:D(()=>[M("\u53D6 \u6D88")]),_:1}),h(f,{type:"primary",onClick:t[4]||(t[4]=p=>s.onDialogBtnClick("confirm"))},{default:D(()=>[M("\u786E \u5B9A")]),_:1})]),default:D(()=>[h(d,{model:r.form,rules:r.formRules,"label-width":"100px",ref:"form"},{default:D(()=>[h(c,{label:"\u6D3B\u52A8\u540D\u79F0:",prop:"title"},{default:D(()=>[h(i,{modelValue:r.form.title,"onUpdate:modelValue":t[0]||(t[0]=p=>r.form.title=p),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),h(c,{label:"\u5F00\u59CB\u65E5\u671F\uFF1A",prop:"startDate"},{default:D(()=>[h(n,{modelValue:r.form.startDate,"onUpdate:modelValue":t[1]||(t[1]=p=>r.form.startDate=p),type:"date",style:{width:"300px"},"value-format":"yyyy-MM-dd"},null,8,["modelValue"])]),_:1}),h(c,{label:"\u7ED3\u675F\u65E5\u671F\uFF1A",prop:"endDate"},{default:D(()=>[h(n,{modelValue:r.form.endDate,"onUpdate:modelValue":t[2]||(t[2]=p=>r.form.endDate=p),type:"date",style:{width:"300px"},"value-format":"yyyy-MM-dd"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1},8,["data"])}const fe=x(ae,[["render",re],["__scopeId","data-v-4b018745"]]);export{fe as default};
