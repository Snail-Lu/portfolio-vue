import{D as T}from"./index-CsToVXX2.js";import{_ as v}from"./index-qd-9JBwJ.js";/* empty css                  *//* empty css                   *//* empty css                  *//* empty css                     *//* empty css                       *//* empty css                 *//* empty css                     */import{r as F,d as C,a as $,b as E,c as I}from"./date-BVJdOfRa.js";import{o as m,q as u,K as p,P as b,Q as k,S as w,J as P,aG as x,U as B,a as h,c as R,w as y,_ as M,A as L,z as A,aK as q,y as N,B as U,aL as z}from"./elementPlus-OXnB-esK.js";const Y={props:{date:Date,schedule:Array},inject:["Calendar"],data(){return{weekDays:["周一","周二","周三","周四","周五","周六","周日"]}},methods:{getFormateDate(e,t){let a=this.curMonthDatePrefix;return t==="prev"?a=this.prevMonthDatePrefix:t==="next"&&(a=this.nextMonthDatePrefix),e=`0${e}`.slice(-2),`${a}-${e}`},getFormateDateTimestamp(e){const t=e.split("-");return new Date(t[0],t[1]-1,t[2]).getTime()},getCellClass({type:e,formatedDate:t}){const a=[e];return e==="current"&&t===this.formatedToday&&a.push("is-today"),a},transformMonthDays(e,t){return e.map(a=>{const o=this.getFormateDate(a,t),r=this.getFormateDateTimestamp(o);return{formatedDate:o,timestamp:r,text:a,type:t}})},toNestedArr(e){return F(e.length/7).map((t,a)=>{const o=a*7;return e.slice(o,o+7)})},getInsertRow(e,t,a){if(e.length===0)return 0;const o=t+a>7?7:t+a+1;let r=-1;for(let s=0,l=e.length;s<l;s++)if(e[s].slice(t,o).every(i=>i.isPlaceholder)){r=s;break}return r},onPickDay(e){this.Calendar.pickDay(e)},onPickSchedule(e){this.Calendar.pickSchedule(e)}},computed:{prevMonthDatePrefix(){const e=new Date(this.date.getTime());return e.setDate(0),C(e,"yyyy-mm")},curMonthDatePrefix(){return C(this.date,"yyyy-mm")},nextMonthDatePrefix(){const e=new Date(this.date.getFullYear(),this.date.getMonth()+1,1);return C(e,"yyyy-mm")},formatedToday(){return this.Calendar.formatedToday},rows(){const{date:e}=this;let t=[],a=$(e);a=a===0?7:a;const o=this.transformMonthDays(E(e,a-1),"prev"),r=this.transformMonthDays(I(e),"current");t=[...o,...r];const s=this.transformMonthDays(F(42-t.length),"next");return t=t.concat(s),this.toNestedArr(t)},scheduleList(){const e=[[],[],[],[],[],[]],{rows:t,schedule:a}=this,o=["#99CCCC","#99CCFF","#FF99CC","#FF9999","#99CC66","#FF9900","#666699","#FF6666"];return a.map((s,l)=>{const i=this.getFormateDateTimestamp(s.startDate),c=this.getFormateDateTimestamp(s.endDate),n=(c-i)/(24*60*60*1e3);return{...s,startTimestamp:i,endTimestamp:c,bgColor:o[l%8],durationDays:n}}).forEach(s=>{t.forEach((l,i)=>{const c=[{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0},{isPlaceholder:!0}];let n=0;l.forEach((d,D)=>{if(d.timestamp>=s.startTimestamp&&d.timestamp<=s.endTimestamp){const g=d.timestamp===s.startTimestamp,_=e[i];if(g)n=this.getInsertRow(_,D,s.durationDays);else if(D===0){const f=(s.endTimestamp-d.timestamp)/864e5;n=this.getInsertRow(_,D,f)}_.length==0?_.push(c):n===-1&&(_.push(c),n=_.length-1),_[n][D]={isStart:g,showTitle:g||D===0,title:s.title||"",id:s.id,bgColor:s.bgColor}}})})}),e}}},K={class:"calendar-table",cellspacing:0,cellpadding:0},j={class:"calendar-table-head"},G=["onClick"],J={key:0,class:"schedule-placeholder"},O=["onClick"];function Q(e,t,a,o,r,s){return m(),u("table",K,[p("thead",j,[(m(!0),u(b,null,k(r.weekDays,l=>(m(),u("th",{key:l},w(l),1))),128))]),p("tbody",null,[(m(!0),u(b,null,k(s.rows,(l,i)=>(m(),u("tr",{key:i,class:P({"calendar-table__row":!0})},[(m(!0),u(b,null,k(l,(c,n)=>(m(),u("td",{key:n,class:P(s.getCellClass(c))},[p("div",{class:"calendar-day",onClick:x(d=>s.onPickDay(c),["stop"])},[p("span",null,w(c.text),1),(m(!0),u(b,null,k(s.scheduleList[i],(d,D)=>(m(),u("div",{key:D},[d[n].isPlaceholder?(m(),u("div",J)):(m(),u("div",{key:1,class:P(["schedule-item",{"is-start":d[n].isStart}]),style:B({"background-color":d[n].bgColor}),onClick:x(g=>s.onPickSchedule(d[n]),["stop"])},w(d[n].showTitle?d[n].title:""),15,O))]))),128))],8,G)],2))),128))]))),128))])])}const V=v(Y,[["render",Q],["__scopeId","data-v-0ab66e7e"]]),H={name:"Calendar",components:{DateTable:V},props:{schedule:Array},provide(){return{Calendar:this}},data(){return{selectedDay:"",now:new Date}},methods:{selectDate(e){let t="";e==="prev-month"?t=`${this.prevMonthDatePrefix}-01`:e==="next-month"?t=`${this.nextMonthDatePrefix}-01`:t=this.formatedToday,this.selectedDay=t},pickDay(e){this.$emit("pick-day",e)},pickSchedule(e){const{id:t,title:a}=e;this.$emit("pick-schedule",{id:t,title:a})}},computed:{prevMonthDatePrefix(){const e=new Date(this.date.getTime());return e.setDate(0),C(e,"yyyy-mm")},nextMonthDatePrefix(){const e=new Date(this.date.getFullYear(),this.date.getMonth()+1,1);return C(e,"yyyy-mm")},currentDate(){const e=this.date.getFullYear(),t=this.date.getMonth()+1;return`${e} 年 ${t} 月`},formatedToday(){return C(this.now,"yyyy-mm-dd")},date(){if(this.selectedDay){const e=this.selectedDay.split("-");return new Date(e[0],e[1]-1,e[2])}return this.now}}},W={class:"calendar"},X={class:"calendar__header"},Z={class:"calendar__title"},ee={class:"calendar__button-group"},te={class:"calendar__body"};function se(e,t,a,o,r,s){const l=V;return m(),u("div",W,[p("div",X,[p("div",Z,w(s.currentDate),1),p("div",ee,[p("button",{class:"btn",onClick:t[0]||(t[0]=i=>s.selectDate("prev-month"))},"上个月"),p("button",{class:"btn",onClick:t[1]||(t[1]=i=>s.selectDate("today"))},"今天"),p("button",{class:"btn",onClick:t[2]||(t[2]=i=>s.selectDate("next-month"))},"下个月")])]),p("div",te,[h(l,{date:s.date,schedule:a.schedule},null,8,["date","schedule"])])])}const S=v(H,[["render",se],["__scopeId","data-v-4ae8b1e0"]]),ae={components:{Demo:T,Calendar:S},name:"PromotionCalendar",data(){return{demoInfo:{title:"促销日历",url:""},schedule:[],dialogFormVisible:!1,form:{title:"",startDate:"",endDate:""},formRules:{title:[{required:!0,message:"请输入活动名称",trigger:"blur"}],startDate:[{required:!0,message:"请选择日期",trigger:"change"}],endDate:[{required:!0,message:"请选择日期",trigger:"change"}]}}},created(){this.getScheduleList()},methods:{async getScheduleList(){let e=await this.req({url:"/demo/calendar"});e.result&&e.result.list&&(this.schedule=e.result.list)},onPickDay(e){const{formatedDate:t}=e;this.dialogFormVisible=!0,this.form.startDate=t},onPickSchedule(e){const{id:t}=e,a=this.schedule.find(o=>o.id===t);a&&(this.form={...a},this.dialogFormVisible=!0)},onDialogBtnClick(e){e==="cancel"?(this.dialogFormVisible=!1,this.$refs.form.resetFields(),this.form={title:"",startDate:"",endDate:""}):e==="confirm"&&this.$refs.form.validate(async t=>{if(t){const{schedule:a,form:o}=this;if(o.id){const r=this.schedule.findIndex(s=>s.id===o.id);this.$set(this.schedule,r,o)}else{const r=a[a.length-1].id+1,s={...o,id:r};this.schedule.push(s)}this.dialogFormVisible=!1}})}}};function re(e,t,a,o,r,s){const l=S,i=L,c=A,n=q,d=N,D=U,g=z,_=T;return m(),R(_,{data:r.demoInfo},{default:y(()=>[h(l,{schedule:r.schedule,onPickDay:s.onPickDay,onPickSchedule:s.onPickSchedule},null,8,["schedule","onPickDay","onPickSchedule"]),h(g,{title:"新增促销活动",modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[5]||(t[5]=f=>r.dialogFormVisible=f),width:"500px"},{footer:y(()=>[h(D,{onClick:t[3]||(t[3]=f=>s.onDialogBtnClick("cancel"))},{default:y(()=>[M("取 消")]),_:1}),h(D,{type:"primary",onClick:t[4]||(t[4]=f=>s.onDialogBtnClick("confirm"))},{default:y(()=>[M("确 定")]),_:1})]),default:y(()=>[h(d,{model:r.form,rules:r.formRules,"label-width":"100px",ref:"form"},{default:y(()=>[h(c,{label:"活动名称:",prop:"title"},{default:y(()=>[h(i,{modelValue:r.form.title,"onUpdate:modelValue":t[0]||(t[0]=f=>r.form.title=f),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),h(c,{label:"开始日期：",prop:"startDate"},{default:y(()=>[h(n,{modelValue:r.form.startDate,"onUpdate:modelValue":t[1]||(t[1]=f=>r.form.startDate=f),type:"date",style:{width:"300px"},"value-format":"yyyy-MM-dd"},null,8,["modelValue"])]),_:1}),h(c,{label:"结束日期：",prop:"endDate"},{default:y(()=>[h(n,{modelValue:r.form.endDate,"onUpdate:modelValue":t[2]||(t[2]=f=>r.form.endDate=f),type:"date",style:{width:"300px"},"value-format":"yyyy-MM-dd"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1},8,["data"])}const De=v(ae,[["render",re],["__scopeId","data-v-4b018745"]]);export{De as default};
