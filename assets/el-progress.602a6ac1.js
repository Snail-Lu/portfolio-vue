import{j as I,k as h,l as M,v as N,u as C,by as ve,bz as se,b7 as he,bA as ie,W as ne,as as be,ab as J,o as g,c as w,n as f,A as e,e as L,B as j,z as S,t as H,h as y,b as F,w as P,d as ye,V as B,C as W,D as de,aA as E,N as pe,f as _e,b8 as ce,a as D,bB as xe,U as A,$ as ke,bC as we,F as $e,bD as ze,aH as Ee,q as Ce,P as Y,bE as Se,bF as Pe,Q as Z,aQ as Re,aT as Te,at as Fe,E as Ue,aI as Le,ba as ee,a9 as te}from"./index.554256c3.js";import{t as G,d as De}from"./error2.0bf5905b.js";import{i as Oe}from"./isNil.98bb3b88.js";import{m as Q}from"./typescript2.b7eef2c1.js";import{u as je}from"./index2.0d3e8b06.js";const ue=Symbol("uploadContextKey"),Be=I({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:o=>o>=0&&o<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:h(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:h([String,Array,Function]),default:""},format:{type:h(Function),default:o=>`${o}%`}}),Ne=["aria-valuenow"],Ae={viewBox:"0 0 100 100"},Ie=["d","stroke","stroke-width"],qe=["d","stroke","opacity","stroke-linecap","stroke-width"],Me={key:0},We={name:"ElProgress"},He=M({...We,props:Be,setup(o){const l=o,a={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},n=N("progress"),c=C(()=>({width:`${l.percentage}%`,animationDuration:`${l.duration}s`,backgroundColor:k(l.percentage)})),p=C(()=>(l.strokeWidth/l.width*100).toFixed(1)),m=C(()=>["circle","dashboard"].includes(l.type)?Number.parseInt(`${50-Number.parseFloat(p.value)/2}`,10):0),$=C(()=>{const i=m.value,R=l.type==="dashboard";return`
          M 50 50
          m 0 ${R?"":"-"}${i}
          a ${i} ${i} 0 1 1 0 ${R?"-":""}${i*2}
          a ${i} ${i} 0 1 1 0 ${R?"":"-"}${i*2}
          `}),z=C(()=>2*Math.PI*m.value),_=C(()=>l.type==="dashboard"?.75:1),d=C(()=>`${-1*z.value*(1-_.value)/2}px`),x=C(()=>({strokeDasharray:`${z.value*_.value}px, ${z.value}px`,strokeDashoffset:d.value})),r=C(()=>({strokeDasharray:`${z.value*_.value*(l.percentage/100)}px, ${z.value}px`,strokeDashoffset:d.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),t=C(()=>{let i;return l.color?i=k(l.percentage):i=a[l.status]||a.default,i}),s=C(()=>l.status==="warning"?ve:l.type==="line"?l.status==="success"?se:he:l.status==="success"?ie:ne),v=C(()=>l.type==="line"?12+l.strokeWidth*.4:l.width*.111111+2),b=C(()=>l.format(l.percentage));function u(i){const R=100/i.length;return i.map((U,O)=>J(U)?{color:U,percentage:(O+1)*R}:U).sort((U,O)=>U.percentage-O.percentage)}const k=i=>{var R;const{color:T}=l;if(be(T))return T(i);if(J(T))return T;{const U=u(T);for(const O of U)if(O.percentage>i)return O.color;return(R=U[U.length-1])==null?void 0:R.color}};return(i,R)=>(g(),w("div",{class:f([e(n).b(),e(n).m(i.type),e(n).is(i.status),{[e(n).m("without-text")]:!i.showText,[e(n).m("text-inside")]:i.textInside}]),role:"progressbar","aria-valuenow":i.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[i.type==="line"?(g(),w("div",{key:0,class:f(e(n).b("bar"))},[L("div",{class:f(e(n).be("bar","outer")),style:j({height:`${i.strokeWidth}px`})},[L("div",{class:f([e(n).be("bar","inner"),{[e(n).bem("bar","inner","indeterminate")]:i.indeterminate}]),style:j(e(c))},[(i.showText||i.$slots.default)&&i.textInside?(g(),w("div",{key:0,class:f(e(n).be("bar","innerText"))},[S(i.$slots,"default",{percentage:i.percentage},()=>[L("span",null,H(e(b)),1)])],2)):y("v-if",!0)],6)],6)],2)):(g(),w("div",{key:1,class:f(e(n).b("circle")),style:j({height:`${i.width}px`,width:`${i.width}px`})},[(g(),w("svg",Ae,[L("path",{class:f(e(n).be("circle","track")),d:e($),stroke:`var(${e(n).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":e(p),fill:"none",style:j(e(x))},null,14,Ie),L("path",{class:f(e(n).be("circle","path")),d:e($),stroke:e(t),fill:"none",opacity:i.percentage?1:0,"stroke-linecap":i.strokeLinecap,"stroke-width":e(p),style:j(e(r))},null,14,qe)]))],6)),(i.showText||i.$slots.default)&&!i.textInside?(g(),w("div",{key:2,class:f(e(n).e("text")),style:j({fontSize:`${e(v)}px`})},[S(i.$slots,"default",{percentage:i.percentage},()=>[i.status?(g(),F(e(B),{key:1},{default:P(()=>[(g(),F(ye(e(s))))]),_:1})):(g(),w("span",Me,H(e(b)),1))])],6)):y("v-if",!0)],10,Ne))}});var Ke=W(He,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const Ve=de(Ke),Xe="ElUpload";class Ye extends Error{constructor(l,a,n,c){super(l),this.name="UploadAjaxError",this.status=a,this.method=n,this.url=c}}function le(o,l,a){let n;return a.response?n=`${a.response.error||a.response}`:a.responseText?n=`${a.responseText}`:n=`fail to ${l.method} ${o} ${a.status}`,new Ye(n,a.status,l.method,o)}function Qe(o){const l=o.responseText||o.response;if(!l)return l;try{return JSON.parse(l)}catch{return l}}const Ge=o=>{typeof XMLHttpRequest=="undefined"&&G(Xe,"XMLHttpRequest is undefined");const l=new XMLHttpRequest,a=o.action;l.upload&&l.upload.addEventListener("progress",p=>{const m=p;m.percent=p.total>0?p.loaded/p.total*100:0,o.onProgress(m)});const n=new FormData;if(o.data)for(const[p,m]of Object.entries(o.data))Array.isArray(m)?n.append(p,...m):n.append(p,m);n.append(o.filename,o.file,o.file.name),l.addEventListener("error",()=>{o.onError(le(a,o,l))}),l.addEventListener("load",()=>{if(l.status<200||l.status>=300)return o.onError(le(a,o,l));o.onSuccess(Qe(l))}),l.open(o.method,a,!0),o.withCredentials&&"withCredentials"in l&&(l.withCredentials=!0);const c=o.headers||{};if(c instanceof Headers)c.forEach((p,m)=>l.setRequestHeader(m,p));else for(const[p,m]of Object.entries(c))Oe(m)||l.setRequestHeader(p,String(m));return l.send(n),l},fe=["text","picture","picture-card"];let Je=1;const ge=()=>Date.now()+Je++,me=I({action:{type:String,default:"#"},headers:{type:h(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>Q({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:h(Array),default:()=>Q([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:fe,default:"text"},httpRequest:{type:h(Function),default:Ge},disabled:Boolean,limit:Number}),Ze=I({...me,beforeUpload:{type:h(Function),default:E},beforeRemove:{type:h(Function)},onRemove:{type:h(Function),default:E},onChange:{type:h(Function),default:E},onPreview:{type:h(Function),default:E},onSuccess:{type:h(Function),default:E},onProgress:{type:h(Function),default:E},onError:{type:h(Function),default:E},onExceed:{type:h(Function),default:E}}),et=I({files:{type:h(Array),default:()=>Q([])},disabled:{type:Boolean,default:!1},handlePreview:{type:h(Function),default:E},listType:{type:String,values:fe,default:"text"}}),tt={remove:o=>!!o},lt=["onKeydown"],ot=["src"],rt=["onClick"],at=["onClick"],st=["onClick"],it={name:"ElUploadList"},nt=M({...it,props:et,emits:tt,setup(o,{emit:l}){const a=o,{t:n}=je(),c=N("upload"),p=N("icon"),m=N("list"),$=pe(!1),z=d=>{a.handlePreview(d)},_=d=>{l("remove",d)};return(d,x)=>(g(),F(ze,{tag:"ul",class:f([e(c).b("list"),e(c).bm("list",d.listType),e(c).is("disabled",d.disabled)]),name:e(m).b()},{default:P(()=>[(g(!0),w($e,null,_e(d.files,r=>(g(),w("li",{key:r.uid||r.name,class:f([e(c).be("list","item"),e(c).is(r.status),{focusing:$.value}]),tabindex:"0",onKeydown:ce(t=>!d.disabled&&_(r),["delete"]),onFocus:x[0]||(x[0]=t=>$.value=!0),onBlur:x[1]||(x[1]=t=>$.value=!1),onClick:x[2]||(x[2]=t=>$.value=!1)},[S(d.$slots,"default",{file:r},()=>[d.listType==="picture"||r.status!=="uploading"&&d.listType==="picture-card"?(g(),w("img",{key:0,class:f(e(c).be("list","item-thumbnail")),src:r.url,alt:""},null,10,ot)):y("v-if",!0),d.listType!=="picture"&&(r.status==="uploading"||d.listType!=="picture-card")?(g(),w("div",{key:1,class:f(e(c).be("list","item-info"))},[L("a",{class:f(e(c).be("list","item-name")),onClick:A(t=>z(r),["prevent"])},[D(e(B),{class:f(e(p).m("document"))},{default:P(()=>[D(e(xe))]),_:1},8,["class"]),L("span",{class:f(e(c).be("list","item-file-name"))},H(r.name),3)],10,rt),r.status==="uploading"?(g(),F(e(Ve),{key:0,type:d.listType==="picture-card"?"circle":"line","stroke-width":d.listType==="picture-card"?6:2,percentage:Number(r.percentage),style:j(d.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):y("v-if",!0)],2)):y("v-if",!0),L("label",{class:f(e(c).be("list","item-status-label"))},[d.listType==="text"?(g(),F(e(B),{key:0,class:f([e(p).m("upload-success"),e(p).m("circle-check")])},{default:P(()=>[D(e(se))]),_:1},8,["class"])):["picture-card","picture"].includes(d.listType)?(g(),F(e(B),{key:1,class:f([e(p).m("upload-success"),e(p).m("check")])},{default:P(()=>[D(e(ie))]),_:1},8,["class"])):y("v-if",!0)],2),d.disabled?y("v-if",!0):(g(),F(e(B),{key:2,class:f(e(p).m("close")),onClick:t=>_(r)},{default:P(()=>[D(e(ne))]),_:2},1032,["class","onClick"])),y(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),y(" This is a bug which needs to be fixed "),y(" TODO: Fix the incorrect navigation interaction "),d.disabled?y("v-if",!0):(g(),w("i",{key:3,class:f(e(p).m("close-tip"))},H(e(n)("el.upload.deleteTip")),3)),d.listType==="picture-card"?(g(),w("span",{key:4,class:f(e(c).be("list","item-actions"))},[L("span",{class:f(e(c).be("list","item-preview")),onClick:t=>d.handlePreview(r)},[D(e(B),{class:f(e(p).m("zoom-in"))},{default:P(()=>[D(e(ke))]),_:1},8,["class"])],10,at),d.disabled?y("v-if",!0):(g(),w("span",{key:0,class:f(e(c).be("list","item-delete")),onClick:t=>_(r)},[D(e(B),{class:f(e(p).m("delete"))},{default:P(()=>[D(e(we))]),_:1},8,["class"])],10,st))],2)):y("v-if",!0)])],42,lt))),128)),S(d.$slots,"append")]),_:3},8,["class","name"]))}});var oe=W(nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const dt=I({disabled:{type:Boolean,default:!1}}),pt={file:o=>Ee(o)},ct=["onDrop","onDragover"],ut={name:"ElUploadDrag"},ft=M({...ut,props:dt,emits:pt,setup(o,{emit:l}){const a=o,n="ElUploadDrag",c=Ce(ue);c||G(n,"usage: <el-upload><el-upload-dragger /></el-upload>");const p=N("upload"),m=pe(!1),$=_=>{if(a.disabled)return;m.value=!1;const d=Array.from(_.dataTransfer.files),x=c.accept.value;if(!x){l("file",d);return}const r=d.filter(t=>{const{type:s,name:v}=t,b=v.includes(".")?`.${v.split(".").pop()}`:"",u=s.replace(/\/.*$/,"");return x.split(",").map(k=>k.trim()).filter(k=>k).some(k=>k.startsWith(".")?b===k:/\/\*$/.test(k)?u===k.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(k)?s===k:!1)});l("file",r)},z=()=>{a.disabled||(m.value=!0)};return(_,d)=>(g(),w("div",{class:f([e(p).b("dragger"),e(p).is("dragover",m.value)]),onDrop:A($,["prevent"]),onDragover:A(z,["prevent"]),onDragleave:d[0]||(d[0]=A(x=>m.value=!1,["prevent"]))},[S(_.$slots,"default")],42,ct))}});var gt=W(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const mt=I({...me,beforeUpload:{type:h(Function),default:E},onRemove:{type:h(Function),default:E},onStart:{type:h(Function),default:E},onSuccess:{type:h(Function),default:E},onProgress:{type:h(Function),default:E},onError:{type:h(Function),default:E},onExceed:{type:h(Function),default:E}}),vt=["onKeydown"],ht=["name","multiple","accept"],bt={name:"ElUploadContent",inheritAttrs:!1},yt=M({...bt,props:mt,setup(o,{expose:l}){const a=o,n=N("upload"),c=Y({}),p=Y(),m=t=>{if(t.length===0)return;const{autoUpload:s,limit:v,fileList:b,multiple:u,onStart:k,onExceed:i}=a;if(v&&b.length+t.length>v){i(t,b);return}u||(t=t.slice(0,1));for(const R of t){const T=R;T.uid=ge(),k(T),s&&$(T)}},$=async t=>{if(p.value.value="",!a.beforeUpload)return z(t);let s;try{s=await a.beforeUpload(t)}catch{s=!1}if(s===!1){a.onRemove(t);return}let v=t;s instanceof Blob&&(s instanceof File?v=s:v=new File([s],t.name,{type:t.type})),z(Object.assign(v,{uid:t.uid}))},z=t=>{const{headers:s,data:v,method:b,withCredentials:u,name:k,action:i,onProgress:R,onSuccess:T,onError:U,httpRequest:O}=a,{uid:K}=t,V={headers:s||{},withCredentials:u,file:t,data:v,method:b,filename:k,action:i,onProgress:q=>{R(q,t)},onSuccess:q=>{T(q,t),delete c.value[K]},onError:q=>{U(q,t),delete c.value[K]}},X=O(V);c.value[K]=X,X instanceof Promise&&X.then(V.onSuccess,V.onError)},_=t=>{const s=t.target.files;!s||m(Array.from(s))},d=()=>{a.disabled||(p.value.value="",p.value.click())},x=()=>{d()};return l({abort:t=>{Se(c.value).filter(t?([v])=>String(t.uid)===v:()=>!0).forEach(([v,b])=>{b instanceof XMLHttpRequest&&b.abort(),delete c.value[v]})},upload:$}),(t,s)=>(g(),w("div",{class:f([e(n).b(),e(n).m(t.listType),e(n).is("drag",t.drag)]),tabindex:"0",onClick:d,onKeydown:ce(A(x,["self"]),["enter","space"])},[t.drag?(g(),F(gt,{key:0,disabled:t.disabled,onFile:m},{default:P(()=>[S(t.$slots,"default")]),_:3},8,["disabled"])):S(t.$slots,"default",{key:1}),L("input",{ref_key:"inputRef",ref:p,class:f(e(n).e("input")),name:t.name,multiple:t.multiple,accept:t.accept,type:"file",onChange:_,onClick:s[0]||(s[0]=A(()=>{},["stop"]))},null,42,ht)],42,vt))}});var re=W(yt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ae="ElUpload",_t=o=>{var l;(l=o.url)!=null&&l.startsWith("blob:")&&URL.revokeObjectURL(o.url)},xt=(o,l)=>{const a=Pe(o,"fileList",void 0,{passive:!0}),n=r=>a.value.find(t=>t.uid===r.uid);function c(r){var t;(t=l.value)==null||t.abort(r)}function p(r=["ready","uploading","success","fail"]){a.value=a.value.filter(t=>!r.includes(t.status))}const m=(r,t)=>{const s=n(t);!s||(console.error(r),s.status="fail",a.value.splice(a.value.indexOf(s),1),o.onError(r,s,a.value),o.onChange(s,a.value))},$=(r,t)=>{const s=n(t);!s||(o.onProgress(r,s,a.value),s.status="uploading",s.percentage=Math.round(r.percent))},z=(r,t)=>{const s=n(t);!s||(s.status="success",s.response=r,o.onSuccess(r,s,a.value),o.onChange(s,a.value))},_=r=>{const t={name:r.name,percentage:0,status:"ready",size:r.size,raw:r,uid:r.uid};if(o.listType==="picture-card"||o.listType==="picture")try{t.url=URL.createObjectURL(r)}catch(s){De(ae,s.message),o.onError(s,t,a.value)}a.value.push(t),o.onChange(t,a.value)},d=async r=>{const t=r instanceof File?n(r):r;t||G(ae,"file to be removed not found");const s=v=>{c(v);const b=a.value;b.splice(b.indexOf(v),1),o.onRemove(v,b),_t(v)};o.beforeRemove?await o.beforeRemove(t,a.value)!==!1&&s(t):s(t)};function x(){a.value.filter(({status:r})=>r==="ready").forEach(({raw:r})=>{var t;return r&&((t=l.value)==null?void 0:t.upload(r))})}return Z(()=>o.listType,r=>{r!=="picture-card"&&r!=="picture"||(a.value=a.value.map(t=>{const{raw:s,url:v}=t;if(!v&&s)try{t.url=URL.createObjectURL(s)}catch(b){o.onError(b,t,a.value)}return t}))}),Z(a,r=>{for(const t of r)t.uid||(t.uid=ge()),t.status||(t.status="success")},{immediate:!0,deep:!0}),{uploadFiles:a,abort:c,clearFiles:p,handleError:m,handleProgress:$,handleStart:_,handleSuccess:z,handleRemove:d,submit:x}},kt={name:"ElUpload"},wt=M({...kt,props:Ze,setup(o,{expose:l}){const a=o,n=Re(),c=Te(),p=Y(),{abort:m,submit:$,clearFiles:z,uploadFiles:_,handleStart:d,handleError:x,handleRemove:r,handleSuccess:t,handleProgress:s}=xt(a,p),v=C(()=>a.listType==="picture-card"),b=C(()=>({...a,onStart:d,onProgress:s,onSuccess:t,onError:x,onRemove:r}));return Fe(()=>{_.value.forEach(({url:u})=>{u!=null&&u.startsWith("blob:")&&URL.revokeObjectURL(u)})}),Ue(ue,{accept:Le(a,"accept")}),l({abort:m,submit:$,clearFiles:z,handleStart:d,handleRemove:r}),(u,k)=>(g(),w("div",null,[e(v)&&u.showFileList?(g(),F(oe,{key:0,disabled:e(c),"list-type":u.listType,files:e(_),"handle-preview":u.onPreview,onRemove:e(r)},ee({append:P(()=>[u.listType==="picture-card"?(g(),F(re,te({key:0,ref_key:"uploadRef",ref:p},e(b)),{default:P(()=>[e(n).trigger?S(u.$slots,"trigger",{key:0}):y("v-if",!0),!e(n).trigger&&e(n).default?S(u.$slots,"default",{key:1}):y("v-if",!0)]),_:3},16)):y("v-if",!0)]),_:2},[u.$slots.file?{name:"default",fn:P(({file:i})=>[S(u.$slots,"file",{file:i})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):y("v-if",!0),u.listType!=="picture-card"?(g(),F(re,te({key:1,ref_key:"uploadRef",ref:p},e(b)),{default:P(()=>[e(n).trigger?S(u.$slots,"trigger",{key:0}):y("v-if",!0),!e(n).trigger&&e(n).default?S(u.$slots,"default",{key:1}):y("v-if",!0)]),_:3},16)):y("v-if",!0),u.$slots.trigger?S(u.$slots,"default",{key:2}):y("v-if",!0),S(u.$slots,"tip"),!e(v)&&u.showFileList?(g(),F(oe,{key:3,disabled:e(c),"list-type":u.listType,files:e(_),"handle-preview":u.onPreview,onRemove:e(r)},ee({_:2},[u.$slots.file?{name:"default",fn:P(({file:i})=>[S(u.$slots,"file",{file:i})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):y("v-if",!0)]))}});var $t=W(wt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Rt=de($t);export{Rt as E};
