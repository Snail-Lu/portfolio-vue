import{D as ee}from"./index-b_4R8An8.js";import{_ as A,e as te}from"./index-BPsOo1ew.js";import{g as I,k as r,L as le,o as g,q as k,K as t,U as R,J as N,Y as se,b as X,f as ae,c as ne,w as oe,P as Y,Q as W,a as O,R as U,S as M,u as ie,W as re,X as ue,_ as ce}from"./elementPlus-OXnB-esK.js";import{A as q}from"./AutoScrollText-DC3UgKlX.js";const ve={__name:"Slider",props:{modelValue:Number,min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},vertical:{type:Boolean,default:!1}},emits:["update:modelValue","change","drag"],setup(w,{emit:T}){const l=w,a=T,o=I(()=>l.vertical?{height:_.value}:{width:_.value}),u=I(()=>l.vertical?{bottom:_.value}:{left:_.value}),e=r(null),C=r(null),_=I(()=>(l.modelValue*100/(l.max-l.min)).toFixed(2)+"%"),v=I(()=>{const n=[l.min,l.max,l.step].map(m=>{const y=`${m}`.split(".")[1];return y?y.length:0});return Math.max.apply(null,n)}),p={};let h=0;le(()=>{const{offsetWidth:n,offsetHeight:m}=e.value;h=l.vertical?m:n});const d=n=>{n.preventDefault(),p.start=l.vertical?n.clientY:n.clientX,p.startPosition=l.modelValue/(l.max-l.min)*h,window.addEventListener("mousemove",V),window.addEventListener("mouseup",c),a("drag")},c=()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",c),a("change",l.modelValue)},V=n=>{let m=n||window.event,y=l.vertical?p.start-m.clientY:m.clientX-p.start,x=p.startPosition+y;B(x)},S=r(null),F=n=>{let m=l.vertical?S.value.getBoundingClientRect().bottom-n.clientY:n.clientX-S.value.getBoundingClientRect().left;const y=B(m);a("change",y)},B=n=>{n<0&&(n=0),n>=h&&(n=h);const m=(l.max-l.min)/l.step;let x=Math.round(n/h*m)*l.step+l.min;return x=Number.parseFloat(x.toFixed(v.value)),a("update:modelValue",x),x};return(n,m)=>(g(),k("div",{class:N([w.vertical?"slider-vertical":"slider"]),ref_key:"slider",ref:S},[t("div",{class:"slider-runway",onClick:F,ref_key:"runway",ref:e},[t("div",{class:"slider-bar",style:R(o.value)},null,4),t("div",{class:"slider-dot",style:R(u.value),onMousedown:d,ref_key:"dot",ref:C},null,36)],512)],2))}},z=A(ve,[["__scopeId","data-v-a46cb1b5"]]);function de(w,T){const l=a=>{const o={ti:"",ar:"",al:"",by:"",offset:0,ms:[]};if(a.length==0)return;const u=a.split(`
`);for(let e in u){u[e]=u[e].replace(/(^\s*)|(\s*$)/g,"");let _=u[e].substring(u[e].indexOf("[")+1,u[e].indexOf("]")).split(":");if(isNaN(parseInt(_[0])))for(let v in o)v!="ms"&&v==_[0].toLowerCase()&&(o[v]=_[1]);else{const v=u[e].match(/\[(\d+:.+?)\]/g);let p=0;for(let d in v)p+=v[d].length;let h=u[e].substring(p);for(let d in v){let V=v[d].substring(1,v[d].length-1).split(":");h&&o.ms.push({t:(parseFloat(V[0])*60+parseFloat(V[1])).toFixed(3),c:h})}}}return o.ms.sort(function(e,C){return e.t-C.t}),o};return new Promise((a,o)=>{te.get(T).then(({data:u})=>{let e=l(u);a(e)}).catch(u=>{o(u)})})}const me=w=>(re("data-v-2ce2b9bd"),w=w(),ue(),w),pe={class:"music-container"},fe=me(()=>t("div",{class:"header flex-box flex-v-center"},[t("span",{class:"logo iconfont icon-music"}),ce(" 音乐播放器 ")],-1)),_e={class:"content"},he={class:"playlist-item-name"},ge={class:"playlist-item-author"},ye=["onClick","title"],xe={class:"disc flex-box flex-v-center flex-h-center"},be={class:"disc-outer flex-box flex-v-center flex-h-center"},ke={class:"disc-inner"},we=["src"],Ce={class:"footer"},Ve={class:"music-info"},Se={class:"song-name"},Ne={class:"song-singer"},Ie={class:"music-duration"},Le={class:"progress"},De={class:"controls flex-box flex-v-center flex-h-between"},Pe=["title"],Te={class:"volume"},Fe={key:0,class:"volume-controls"},Me=["src"],Be={__name:"index",setup(w){const T={title:"音乐播放器",url:""},{proxy:l}=se(),a=r([]),o=r(0),u=()=>{o.value===1?o.value=2:o.value=1};l.req({url:"/demo/playlist"}).then(s=>{a.value=s.result.list});const e=r(0),C=r(0),_=I(()=>x(C.value)),v=r(0),p=r(0),h=I(()=>x(p.value)),d=r(!0),c=r(null),V=s=>{typeof s<"u"&&(e.value=s),c.value.paused?(c.value.play(),E.value=!0):(c.value.pause(),d.value=c.value.paused),j.value=!1},S=r(.2);X(S,s=>{c.value&&(c.value.volume=s)},{immediate:!0});const F=r(!1),B=s=>{F.value=!0},n=s=>{c.value.currentTime=s,F.value=!1},m=r(!1),y=()=>{m.value=!m.value},x=s=>{let i=Math.floor(s/60),b=Math.floor(s%60);return i=String(i).padStart(2,"0"),b=String(b).padStart(2,"0"),`${i}:${b}`};let L=ae({ms:[],al:"",ar:"",by:"",offset:0,ti:""});const j=r(!0),E=r(!1),J=()=>{C.value=Math.round(c.value.duration),de("",a.value[e.value].lyricUrl).then(s=>{if(s)for(let i in s)L[i]=s[i]}),j.value||(c.value.play(),E.value=!0)},D=r(0);X(v,s=>{if(L.ms&&s>0){const i=L.ms.length;if(s>parseFloat(L.ms[i-1].t))D.value=i-1;else if(D.value<i-2){let b=L.ms.findIndex($=>s<$.t);b>0&&(D.value=b-1)}}});const K=I(()=>{if(D.value*30>=150)return-(D.value*30-150)+"px"}),Q=()=>{if(F.value)return;let s=Math.round(c.value.currentTime);p.value=s,v.value=s,d.value=c.value.paused},G=()=>{d.value=!0,v.value=0,E.value=!1,H()},H=()=>{e.value<a.value.length-1?e.value++:e.value=0},Z=()=>{e.value>0?e.value--:e.value=a.value.length-1};return(s,i)=>(g(),ne(ee,{data:T},{default:oe(()=>{var b,$;return[t("div",pe,[fe,t("div",_e,[o.value!==0?(g(),k("div",{key:0,class:N(["playlist animate__animated animate__faster",{playlist__hidden:o.value===0,animate__slideInLeft:o.value===1,animate__slideOutLeft:o.value===2}])},[(g(!0),k(Y,null,W(a.value,(f,P)=>(g(),k("div",{class:N(["playlist-item flex-box flex-v-center",{"playlist-item-active":e.value===P}]),key:f.url},[t("div",he,[O(q,{text:f.name},null,8,["text"])]),t("div",ge,[O(q,{text:f.author},null,8,["text"])]),t("span",{class:N(["play-btn iconfont",e.value!==P||d.value?"icon-play":"icon-pause"]),onClick:Ee=>V(P),title:e.value!==P||d.value?"播放":"暂停"},null,10,ye)],2))),128))],2)):U("",!0),t("div",xe,[t("div",be,[t("div",ke,[a.value[e.value]?(g(),k("img",{key:0,src:a.value[e.value].coverUrl,class:N(["cover-img",{"cover-img-rotate":E.value,"cover-img-rotate-paused":d.value}]),alt:""},null,10,we)):U("",!0)])])]),t("div",{class:"lyric",style:R({marginTop:K.value})},[(g(!0),k(Y,null,W(ie(L).ms,(f,P)=>(g(),k("p",{class:N(["lyric-text",D.value===P?"lyric-text-current":""]),key:f.t},M(f.c),3))),128))],4)]),t("div",Ce,[t("div",Ve,[t("div",null,[t("span",Se,M((b=a.value[e.value])==null?void 0:b.name),1),t("span",Ne," - "+M(($=a.value[e.value])==null?void 0:$.author),1)]),t("div",Ie,[t("span",null,M(h.value),1),t("span",null," / "+M(_.value),1)])]),t("div",Le,[O(z,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=f=>p.value=f),max:C.value,onChange:n,onDrag:B},null,8,["modelValue","max"])]),t("div",De,[t("div",{class:"playlist-btn iconfont icon-playlist",title:"播放列表",onClick:u}),t("div",null,[t("span",{class:"prev iconfont icon-prev",title:"上一首",onClick:Z}),t("span",{class:N(["switch iconfont",d.value?"icon-play":"icon-pause"]),onClick:i[1]||(i[1]=f=>V()),title:d.value?"播放":"暂停"},null,10,Pe),t("span",{class:"next iconfont icon-next",title:"下一首",onClick:H})]),t("div",Te,[t("span",{class:"volume-icon iconfont icon-volume",onClick:y}),m.value?(g(),k("div",Fe,[O(z,{modelValue:S.value,"onUpdate:modelValue":i[2]||(i[2]=f=>S.value=f),max:1,step:.1,vertical:""},null,8,["modelValue"])])):U("",!0)])])]),a.value.length>0?(g(),k("audio",{key:0,ref_key:"audio",ref:c,onCanplay:J,onTimeupdate:Q,onEnded:G,src:a.value[e.value].url},null,40,Me)):U("",!0)])]}),_:1}))}},je=A(Be,[["__scopeId","data-v-2ce2b9bd"]]);export{je as default};
